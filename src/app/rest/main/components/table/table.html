<app-iconbar (update)="onUpdate($event)"></app-iconbar>

<div>
  <div style="width:100%; display:flex; flex-direction: column;">

    <mat-form-field class="w-100" appearance="outline">
      <mat-label>Filter by Title</mat-label>
      <input matInput placeholder="Title" value="" [(ngModel)]="filterTitle" (input)="applyFilters()">
    </mat-form-field>

    <mat-form-field class="w-100" appearance="outline">
      <mat-label>Platform</mat-label>
      <mat-select [(ngModel)]="filterPlatform" (selectionChange)="applyFilters()">
        <mat-option value="">All Platforms</mat-option>
        @for (p of platforms; track p) {
          <mat-option [value]="p">{{ p.replaceAll('_', ' ') }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" floatLabel="always">
      <mat-label>Rating</mat-label>
      <mat-select [(ngModel)]="filterRating" (selectionChange)="applyFilters()">
        <mat-option value="">All Ratings</mat-option>
        @for (r of ratings; track r) {
          <mat-option [value]="r">{{ r.replaceAll('_', ' ') }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

  </div>

  <div class="boxfilter mt-1">

    <div class="form-check form-check-inline">
      <input type="checkbox" class="form-check-input" id="collectionFilter" [(ngModel)]="filterCollection" (change)="applyFilters()">
      <label class="form-check-label" for="collectionFilter">Collection</label>
    </div>

    <div class="form-check form-check-inline">
      <input type="checkbox" class="form-check-input" id="fangameFilter" [(ngModel)]="filterFangame" (change)="applyFilters()">
      <label class="form-check-label" for="fangameFilter">Fangame</label>
    </div>

    <div class="form-check form-check-inline">
      <input type="checkbox" class="form-check-input" id="flashFilter" [(ngModel)]="filterFlash" (change)="applyFilters()">
      <label class="form-check-label" for="flashFilter">Flash</label>
    </div>

    <div class="form-check form-check-inline">
      <input type="checkbox" class="form-check-input" id="favouriteFilter" [(ngModel)]="filterFavourite" (change)="applyFilters()">
      <label class="form-check-label" for="favouriteFilter">Favourite</label>
    </div>

  </div>
</div>

@if(filteredGames.length == 0){
  <h1>No Videogames. Too Bad !</h1>
}@else {
  <table class="table table-striped table-bordered">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>TITLE</th>
        <th>PLATFORM</th>
        <th>
          RATING
          <button mat-icon-button (click)="toggleRatingSort()">
            <mat-icon class="white-icon">
              {{ ratingSort === 'asc' ? 'arrow_upward' : ratingSort === 'desc' ? 'arrow_downward' : 'swap_vert' }}
            </mat-icon>
          </button>
        </th>
        <th>GENRES</th>
        <th>COLLECTION</th>
        <th>ROMHACK</th>
        <th>FANGAME</th>
        <th>FLASH</th>
        <th>FAVOURITE</th>
        <th>EDIT</th>
        <th>DELETE</th>
      </tr>
    </thead>
    <tbody>
      @for (game of filteredGames; track game.id) {
        <tr>
          <td class="id">{{ game.id }}</td>
          <td>{{ game.title }}</td>
          <td class="platform">{{ game.platform.replaceAll("_"," ") }}</td>
          <td class="rating">{{ game.rating }}</td>
          <td class="cellcenter">
            <div class="d-flex flex-wrap gap-1 justify-content-center genres">
              @for (genre of game.genres; track genre) {
                <span class="badge bg-secondary">
                  {{ genre.replaceAll('_', ' ') }}
                </span>
              }
            </div>
          </td>
          <td class="cellcenter">
            @if(game.collection){
              &#x2705;
            }
          </td>
          <td class="cellcenter">
            @if(game.romhack){
              &#x2705;
            }
          </td>
          <td class="cellcenter">
            @if(game.fangame){
              &#x2705;
            }
          </td>
          <td class="cellcenter">
            @if(game.flash){
              &#x2705;
            }
          </td>
          <td class="cellcenter">
            @if(game.favourite){
              &#x2B50;
            }
          </td>
          <td class="cellcenter">
            <button (click)="editVideogame(game)" class="btn btn-primary">EDIT</button>
          </td>
          <td class="cellcenter">
            <button (click)="deleteVideogame(game.id!)" class="btn btn-danger">X</button>
          </td>
        </tr>
      }
    </tbody>
  </table>
}
